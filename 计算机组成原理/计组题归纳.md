# 概述

## 【地址线和寻址范围】

1. 假设计算机系统的地址线有16根，那么该系统的寻址范围是多少？	

   **[地址线位数和寻址范围计算]**

> 🐾
>
> **地址线的位数决定了系统可以寻址的内存单元数量。**
>
> 具体计算方法如下：
>
> **寻址范围 = $2^{地址线位数} B$**
>
> 8bit=1B
>
> 1B=1024KB=2^10^B
>
> 1MB=1024KB=2^10^KB
>
> 1MB=1024*1024B=2^20^B
>
> 🤍
>
> 地址线=16根，所以寻址范围 =$ 2^{16}$ = 65536B=2^10^ ×2^6^ B=64KB
>
> 这里的寻址范围通常也指**它的存储空间大小**



2. 假设一个计算机系统的寻址范围是4096个内存单元，那么该系统至少需要多少位的地址线？

   **[给定的寻址范围确定地址线的位数]**

> 🐾
>
> **地址线位数=log2~2~(寻址范围)**
>
> ![image-20230517214124555](%E8%AE%A1%E7%BB%84%E9%A2%98%E5%BD%92%E7%BA%B3.assets/image-20230517214124555.png)
>
> 🤍
>
> 寻址范围=4096B ，则地址线位数=log~2~4096 ≈12
>
> 因此，该系统至少需要12根地址线来实现对4096个内存单元的寻址。

3. 假设CPU有20根地址线和32根数据线，试问按字节和字寻址，寻址范围分别是多少？

> 🐾
>
> **字节寻址**	, 每个内存单元被视为一个字节（8位）	, **寻址范围取决于地址线的位数**
>
> **寻址范围 = $2^{地址线位数}$**
>
> **字寻址**	, 每个内存单元被视为一个字（通常是32位或64位)	, 需要拿出地址线来做字内字节寻址**，剩余的地址线用来寻址
>
> 🤍
>
> 按**字节寻址**——地址线=20根，寻址范围=2^20^，1个内存单元=8bit=1B，则$寻址范围=2^{20}B=1MB$
>
> 按**字寻址**，寻址范围=2^20^，数据是通过数据线并行取出的，有32根数据线，意思是字长是32bit，即4B，
>
> 所以把4个字节打包成一个单位看，则$寻址范围=\frac{2^{20}}{4}=2^{18}=256KB$

## 【CPI、MIPS、主频、执行时间】

![image-20230701213142875](%E8%AE%A1%E7%BB%84%E9%A2%98%E5%BD%92%E7%BA%B3.assets/image-20230701213142875.png)

![image-20230701213342019](%E8%AE%A1%E7%BB%84%E9%A2%98%E5%BD%92%E7%BA%B3.assets/image-20230701213342019.png)

![image-20230701211742404](%E8%AE%A1%E7%BB%84%E9%A2%98%E5%BD%92%E7%BA%B3.assets/image-20230701211742404.png)

1. 假设某机器 M 的时钟频率为 4GHz，用户程序 P 在 M 上的指令条数为 8x10^9^，其 CPI 为 1.25，则 P 在 M 上的执行时间是多少？若在机器 M 上从程序 P 开始启动到执行结束所需的时间是 4 秒，则 P 占用的 CPU 时间的百分比是多少？

   **[求执行时间]**

> 🐾
>
> $主频=\frac{1}{时钟周期}  $    	 					$时钟周期数=指令条数*CPI$          
>
> $执行时间=\frac{时钟周期数}{主频}=\frac{CPI*指令条数}{主频}$ 
>
> 1 GHz=10^3^ kHz=10^6^ MHz=10^9^ Hz
>
> 🤍
>
> 4G HZ=4*10^9^Hz
>
> $主频=\frac{1}{4×10^9}$
>
> 







# 存储系统

## 主存储器

### 【 地址冲突】

1. 某计算机使用四位交叉编址存储器，假定在存储器总线上出现的主存地址（十进制）序列为8005，8006，8007，8008，8001，8002，8003，8004，8000，则可能发生访存冲突的地址对是（）

   ![image-20230707074451573](%E8%AE%A1%E7%BB%84%E9%A2%98%E5%BD%92%E7%BA%B3.assets/image-20230707074451573.png)



### 【存取速率(带宽)】

![image-20230707081000117](%E8%AE%A1%E7%BB%84%E9%A2%98%E5%BD%92%E7%BA%B3.assets/image-20230707081000117.png)













### 【地址引脚（线数）+数据线及其他线+主存容量】

1. 某一SRAM芯片，其容量为1024×8位，除电源和接地端外，该芯片的引脚的最小数目是（）

   > 1. 容量为1024×8位，则芯片容量为1024B，1024B=2^10^，则地址线为10根
   >
   > 2. 8位——说明数据线=8根，
   > 3. 芯片引脚至少要有1根片选线+2根读写控制线
   > 4. 芯片引脚=地址线10根+数据线8根+片选线1根+读写控制线2根=10+8+1+2=21根

   

2. 某存储器容量位32K×16位，则地址线为（）根，数据线为（）根。

   > 32K=2^15^，地址线15根									16位，数据线16根

   

3.  某容量为256MB的存储器由若干4M×8位的DRAM芯片构成,该DRAM芯片的地址引脚和数据引脚总数是（ ）

   > - 4M=2^22^，DRAM**地址复用技术线 ——地址线折半**地址线=22/2=11根
   >
   > - 8位 ，数据引脚=8根       总=11+8=19

   

4. 某一**DRAM**芯片，采用地址复用技术，其容量为1024×8位，除电源线和接电线外，该芯片的引脚的最小数目是

   > - 地址复用技术：
   >
   >   **通过 行选 和列选 分行、列两次传送地址，因此==地址线减半===5根**
   >
   > - 数据线跟1题一样，不变，数据线=8根。
   > - 芯片引脚= 行选线1根（代替片选线）+列选线1根+读写控制线2根+数据线8根+地址线5根=1+1+2+8+5=17根
   >
   > 💫❗❗       **==DRAM采用地址复用技术，SRAM不采用。==**



### 【求芯片数、主存容量】

1. 设CPU地址总线有24根，数据总线有32根，用512K×8位的RAM芯片构成该机的主存储器，则该机主存最多需要（）片这样的存储芯片

   > - 地址线24根——>寻址范围 2^24^
   > - 数据线32根——>字长32位
   > - 主存容量=2^24^×32位
   > - 因此所需存储芯片数$=\frac{2^{24}×32}{512K×8}=\frac{2^{29}}{2^{12}}=2^{7}=128$

   

2. 求





---



## Cache

### 【Cache命中率、缺失率、平均访问时间、效率】

![image-20230704165132965](%E8%AE%A1%E7%BB%84%E9%A2%98%E5%BD%92%E7%BA%B3.assets/image-20230704165132965.png)

1. 假设 Cache 的速度是主存的 5 倍，且 Cache 的命中率为 95%，则采用 Cache 后存储器性能**提高多少**?

   **[求cache性能效率]**

> 🤍
>
> 设cache的存取为 t，主存存取周期为 5t
>
> 1. 采用Cache和主存同时被访问
>
>    由题得h=95%
>
>    则 $T_a~=0.95*t+0.05*5t=1.2t$
>
>    性能$e=\frac{5t}{1.2t}≈4.17$，即提高了4.17倍
>
> 2. 若采用先访问Cache再访问主存
>
>    由题得h=95%
>
>    则  $T_a~=0.95*t+0.05*6t=1.25t$
>
>    性能$e=\frac{5t}{1.25t}=4$，即提高了4倍

2. 假设CPU执行某段程序时，共访问Cache命中2000次，访问主存50次，则cache-主存系统的命中率为__

> 🐾
>
> $命中率=\frac{Cache命中次数}{Cache命中次数+主存访问次数}$
>
> 🤍
>
> $h=\frac{2000}{2050}≈0.97$，即命中率为97%

3. CPU执行一段程序时，Cache完成存取的次数为1900次，主存完全存取的次数为100次，已知Cache存取周期为50ns,主存存取周期为250ns，求Cache/主存系统的效率和平均访问时间

> 🐾
>
> $命中率=\frac{Cache命中次数}{Cache命中次数+主存访问次数}$
>
> ​	$	r=\frac{主存存取周期}{Cache存取周期}=\frac{t_m}{t_c}$               $性能效率 e=\frac{访问Cache的时间}{平均访问时间}=\frac{t_c}{t_a}$
>
> 🤍
>
> 由题意得 Cache命中的时间	t~c~=50ns  ,Cache未命中的时间（主存的时间）	t~m~=250ns
>
> ①先求命中率 $h=\frac{1900}{1900+100}=95\%$ 					缺失率=$1-95\%=5\%$
>
> ②求平均访问时间	$t_a=h*t_c+(1-h)t_m=0.95*50+0.05*250=60ns$  ，即平均访问时间为60ns
>
> ③求效率  			$e=\frac{tc}{ta}=\frac{50}{60}≈83.3\%$



###  【地址结构】

#### 直接映射

<img src="%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86.assets/image-20230705110718108.png" alt="image-20230705110718108" style="zoom:50%;" />



**例题：设主存容量 1MB，Cache容量 16KB，块大小为 512B，采用直接映射方式。**

1. 写出**Cache的地址格式：**

   > <img src="%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86.assets/image-20230705104348497.png" alt="image-20230705104348497" style="zoom:45%;" />
   >
   > ①	Cache容量=16 KB=2^14^ B	, 则 Cache的总位数=14位
   > 	
   > ②	块大小=行大小=512B=2^9^ B	, 则 **行内地址b=9**
   > 	
   > ③	**cache行标记位c=14-9=5 位**	,则 Cache共有	2^5^=32行

   

2. 写出**主存地址格式** ：

> <img src="%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86.assets/image-20230705104938900.png" alt="image-20230705104938900" style="zoom:45%;" />
>
> ①	主存容量=1MB=2^20^ B  ,  则 主存的总位数=20位
> 	
> ②	块大小=512B=2^9^ B  , 则 **块内地址 b=9**
> 		
> ③	**主存块号 m=20-9=11**  , 则 主存共有 2^11^=2048块
> 		
> ④	**m= t (主存标记)+ c (cache行号)=11**
> 		
> ⑤	由上题得出 c=5，则**主存标记位 t =m-c=11-5=6位**







#### 全相联映射

<img src="%E8%AE%A1%E7%BB%84%E9%A2%98%E5%BD%92%E7%BA%B3.assets/image-20230705110803056-16885494476951.png" alt="image-20230705110803056" style="zoom:50%;" />

**例题：设主存容量 1MB，Cache容量 16KB，块大小为 512B，采用全相联映射方式。**

1. 写出**Cache的地址格式：**

   > <img src="%E8%AE%A1%E7%BB%84%E9%A2%98%E5%BD%92%E7%BA%B3.assets/image-20230705100428855-16885494476962.png" alt="image-20230705100428855" style="zoom:50%;" />
   >
   > 跟直接映射步骤相同

   

2. 写出**主存地址格式** ：

   > <img src="%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86.assets/image-20230705100047108.png." alt="image-20230705100047108" style="zoom:50%;" />
   >
   > ①	主存容量=1MB=2^20^ B  ,  则 主存的总位数=20位
   > 	
   > ②	块大小=512B=2^9^ B  , 则 **块内地址 b=9**
   > 	
   > ③	**主存块号 m=20-9=11**  , 则 主存共有 2^11^=2048块



#### 组相联映射

<img src="%E8%AE%A1%E7%BB%84%E9%A2%98%E5%BD%92%E7%BA%B3.assets/image-20230705115613765-16885494476973.png" alt="image-20230705115613765" style="zoom:50%;" />

**例题：一个组相联Cache由 64个行组成，每组4行。主存储器包含4K个块，每块128字。**

写出**内存地址**的格式：

> 🤍
>
> 由题意得
>
> <img src="%E8%AE%A1%E7%BB%84%E9%A2%98%E5%BD%92%E7%BA%B3.assets/image-20230705172845095-16885494476974.png" alt="image-20230705172845095" style="zoom:45%;" />
>
> ①	主存的总块数=2^m^=4K  , 4K=2^12^  , m=12 
>
> ② 	块大小=128字=2^7^  ,  **块内地址b=7**
>
> ③	每组4行   ,  	r=4
>
> ④	Cache由 64个行组成  , 总行数=64=r*Q(组数)  , **求出组数 Q=64/4=16组** 	
>
> ⑤	分组数=2^q^  	, 则 16=2^4^  , 求出**Cache组号 q=4**  
>
> ⑥	m=q+s   则 主存标记位 **s=m-q=12-4=8**





### 【容量、映射方式、行号】

1. 假设某个计算机的主存地址空间大小为256MB，按字节编址，其数据Cache有8个cache行，行长为64B。

2. 若不考虑Cache的一致维护性和替换算法控制位，并且采用直接映射方式，则该数据Cache的**总容量是多少？**
3. 若该Cache采用直接映射方式，则主存地址为3200（十进制）的主存对应的**Cache行号是多少？**若采用**二路组相连映射**又是多少？
4. 以直接映射方式为例，简述访存过程（访存的地址为0123456H）

> 🐾
>
> 1MB=1024*1024B=2^20^B
>
> <img src="%E8%AE%A1%E7%BB%84%E9%A2%98%E5%BD%92%E7%BA%B3.assets/image-20230705182912649.png" alt="image-20230705182912649" style="zoom:50%;" />
>
> - **Cache的地址结构**
>
> ​	<img src="%E8%AE%A1%E7%BB%84%E9%A2%98%E5%BD%92%E7%BA%B3.assets/image-20230705184349282.png" alt="image-20230705184349282" style="zoom:40%;" />
>
> - **cache总容量=**包括存储容量（行内地址容量）、Cache行标记项(有效位+标记位+其他（本题忽略）)
>
>   cache总容量=cache行数×cache行的位数
>   cache总容量=cache行数×(cache行标记项位数+cache块位数)
>
> - **块内地址以字节为单位计算**，即 **块内地址 = 一个块的字节数的二次方的指数**， 其余相同
>

>
> 🤍
>
> - 由题意得
>
>   1. 地址空间=256MB=256×2^20^=2^28^，则主存总位数=28 位
>
>   2. Cache行数=2^c^=8=2^3^  ，则Cache行号c=3位
>
>   3. 行长=行大小=块大小=2^b^=64B  ，则64B=2^6^ ，块内地址 =行内地址=b=6位——>64B=512bit
>
>   4. 则Cache行标记=28-6-3=19bit
>

> 1. 求Cache的总容量
>
>    - 按字节寻址，则存储容量=行长=64B=64×8=512bit
>
>    - cache总容量=8 ×(1+19+512)=8 × 532=4256

>2. **主存地址为3200（十进制）的主存对应的Cache行号是多少？**
>   - 3200对应的字块号是$\frac{3200}{64}=50$		则行号=块号 mod 行数=50 mod 8=2
>   - 即Cache的行号为2
>

>3. **采用二路组相连映射又是多少？**
>
>
>  - 实质上就是将两个Cache行合并，内部采用全相联方式，外部采用直接映射方式
>  - 50mod 4=2            对应的组号=2，对应的Cache行号为4或者5
>

